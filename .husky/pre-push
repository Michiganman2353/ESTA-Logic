# Verify branch is not diverged from main (prevents merge conflicts)
if git fetch origin main --quiet 2>/dev/null; then
    if ! git merge-base --is-ancestor origin/main HEAD 2>/dev/null; then
        echo "Warning: Your branch has diverged from origin/main."
        echo "Consider running 'git pull --rebase origin main' before pushing."
    fi
else
    echo "Note: Unable to fetch origin/main - skipping divergence check."
fi

# Lint affected files before push
nx affected --target=lint --base=origin/main || {
    echo "Linting failed - please fix lint errors before pushing"
    exit 1
}
